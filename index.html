<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Стеклянный мост — белые цифры</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(180deg, #071521 0%, #2b0b2f 100%);
    color: #ffffff;
    font-family: 'Inter', Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
  }
  .ladder {display:flex;flex-direction:column;align-items:center;gap:14px;margin-top:20px;}
  .step {display:flex;align-items:center;justify-content:space-between;width:90%;max-width:360px;}
  .glass-tile {
    width: 120px;
    height: 44px;
    border-radius: 6px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    color: #ffffff;
    transition: all 0.15s ease;
  }
  .glass-tile.ok {border-color: rgba(126,231,135,0.25);}
  .glass-tile.fail {border-color: rgba(255,123,123,0.25);}
  .num {font-weight: 800; font-size: 20px; text-align: center; width: 60px;}
  button {margin:10px;padding:10px 16px;border-radius:24px;border:none;cursor:pointer;font-weight:700;}
  .start {background:#16a39a;color:#000;}
  .reset {background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.2);}
  @media(max-width:480px){
    .step{flex-direction:column;}
    .glass-tile{width:90%;max-width:200px;}
  }
</style>
</head>
<body>
<h3>Стеклянный мост (9 уровней)</h3>
<div id="status">Статус: ожидание</div>
<div class="ladder" id="ladder"></div>
<div>
  <button class="start" id="startBtn">Начать</button>
  <button class="reset" id="resetBtn">Сброс</button>
</div>

<script>
(function(){
  const VALUES = [256,128,64,32,16,8,4,2,1];
  const LOGIC_VALUES = [1,2,4,8,16,32,64,128,256];
  const LEVEL_COUNT = LOGIC_VALUES.length;
  const ladder = document.getElementById('ladder');
  const statusEl = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  let state = { running:false, currentLevel:1, targets:{} };

  function build(){
    ladder.innerHTML = '';
    VALUES.forEach((val,i)=>{
      const step = document.createElement('div');
      step.className = 'step';
      step.dataset.visualIndex = i;
      const left = document.createElement('div');
      left.className = 'glass-tile';
      left.dataset.side = 'left';
      left.dataset.visualIndex = i;
      const num = document.createElement('div');
      num.className = 'num';
      num.textContent = val;
      const right = document.createElement('div');
      right.className = 'glass-tile';
      right.dataset.side = 'right';
      right.dataset.visualIndex = i;
      step.append(left,num,right);
      ladder.append(step);
    });
  }

  function genTargets(){
    state.targets = {};
    for(let l=1;l<=LEVEL_COUNT;l++)
      state.targets[l] = (Math.random()<0.5)?'left':'right';
  }

  function visualIndexForLogicLevel(level){
    return LEVEL_COUNT - level;
  }

  function disableAll(){
    ladder.querySelectorAll('.glass-tile').forEach(t=>{
      t.onclick=null;
      t.classList.remove('fail');
    });
  }

  function enableCurrent(){
    disableAll();
    const vidx = visualIndexForLogicLevel(state.currentLevel);
    const step = ladder.querySelector(`.step[data-visual-index="${vidx}"]`);
    if(!step) return;
    const left = step.querySelector('[data-side="left"]');
    const right = step.querySelector('[data-side="right"]');
    left.onclick=()=>handleChoice('left',left,right);
    right.onclick=()=>handleChoice('right',left,right);
    statusEl.textContent = `Уровень ${state.currentLevel}/${LEVEL_COUNT}`;
  }

  function handleChoice(side,leftEl,rightEl){
    if(!state.running) return;
    const lvl = state.currentLevel;
    const target = state.targets[lvl];
    const val = LOGIC_VALUES[lvl-1];
    if(side===target){
      const el=(side==='left')?leftEl:rightEl;
      el.classList.add('ok');
      el.textContent = val;
      state.currentLevel++;
      if(state.currentLevel>LEVEL_COUNT){
        state.running=false;
        statusEl.textContent='Мост пройден!';
        disableAll();
        alert('Мост пройден!');
      } else {
        enableCurrent();
      }
    } else {
      const el=(side==='left')?leftEl:rightEl;
      el.classList.add('fail');
      statusEl.textContent='Ошибка. Возврат к началу';
      setTimeout(()=>{state.currentLevel=1;genTargets();build();enableCurrent();},600);
    }
  }

  startBtn.onclick=()=>{
    state.running=true;state.currentLevel=1;genTargets();build();enableCurrent();
    statusEl.textContent='Игра начата';
  };
  resetBtn.onclick=()=>{
    state.running=false;state.currentLevel=1;genTargets();build();
    statusEl.textContent='Статус: ожидание';
  };

  build(); genTargets();
})();
</script>
</body>
</html>